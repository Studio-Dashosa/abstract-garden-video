<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abstract Garden - Souls of Creation</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Crimson+Text:ital@0;1&family=JetBrains+Mono:wght@300;400&display=swap');
        
        /* FromSoft Dark Theme */
        :root {
            --blood-dark: #0A0806;
            --ash-black: #141210;
            --stone-dark: #1C1A17;
            --ember-glow: #B8860B;
            --blood-red: #8B0000;
            --soul-blue: #4169E1;
            --pale-text: #C4B5A0;
            --faded-text: #8B8378;
            --border-iron: #3A3532;
            --success-green: #2F4F2F;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Crimson Text', serif;
            background: var(--blood-dark);
            color: var(--pale-text);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Dark Souls fog effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at center, transparent 0%, rgba(10, 8, 6, 0.4) 100%);
            pointer-events: none;
            animation: fogPulse 20s ease-in-out infinite;
        }

        @keyframes fogPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem 0;
            border-bottom: 1px solid var(--border-iron);
        }

        h1 {
            font-family: 'Cinzel', serif;
            font-size: 3.5rem;
            font-weight: 600;
            color: var(--ember-glow);
            text-transform: uppercase;
            letter-spacing: 0.3rem;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }

        .subtitle {
            font-style: italic;
            color: var(--faded-text);
            font-size: 1.1rem;
            letter-spacing: 0.1rem;
        }

        /* Currency Bar */
        .souls-bar {
            display: flex;
            justify-content: center;
            gap: 3rem;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: var(--ash-black);
            border: 1px solid var(--border-iron);
        }

        .soul-counter {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-family: 'JetBrains Mono', monospace;
        }

        .soul-value {
            font-size: 1.25rem;
            color: var(--pale-text);
            font-weight: 400;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--stone-dark);
            border: 1px solid var(--border-iron);
            padding: 1.5rem;
            position: relative;
            transition: border-color 0.3s;
        }

        .stat-card:hover {
            border-color: var(--ember-glow);
        }

        .stat-label {
            font-family: 'Cinzel', serif;
            font-size: 0.85rem;
            color: var(--faded-text);
            text-transform: uppercase;
            letter-spacing: 0.1rem;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 2rem;
            color: var(--ember-glow);
            font-weight: 300;
        }

        .stat-subtitle {
            font-size: 0.85rem;
            color: var(--faded-text);
            margin-top: 0.25rem;
            font-style: italic;
        }

        /* Progress Section */
        .estus-progress {
            background: var(--ash-black);
            border: 1px solid var(--border-iron);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .progress-title {
            font-family: 'Cinzel', serif;
            font-size: 1.25rem;
            color: var(--pale-text);
        }

        .progress-bar {
            height: 8px;
            background: var(--blood-dark);
            border: 1px solid var(--border-iron);
            position: relative;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--ember-glow);
            transition: width 1s ease;
            box-shadow: 0 0 10px var(--ember-glow);
        }

        .progress-message {
            margin-top: 1rem;
            color: var(--faded-text);
            font-style: italic;
            text-align: center;
        }

        /* Sprint Cards - Bonfire Style */
        .bonfire-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .bonfire-card {
            background: var(--stone-dark);
            border: 1px solid var(--border-iron);
            padding: 1.5rem;
            position: relative;
        }

        .bonfire-card.lit {
            border-color: var(--ember-glow);
            box-shadow: inset 0 0 20px rgba(184, 134, 11, 0.1);
        }

        .bonfire-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .bonfire-title {
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            color: var(--pale-text);
        }

        .bonfire-progress {
            height: 4px;
            background: var(--blood-dark);
            margin-bottom: 0.5rem;
        }

        .bonfire-flame {
            height: 100%;
            background: var(--ember-glow);
            transition: width 0.6s;
        }

        /* Memory Grid */
        .memory-chamber {
            background: var(--ash-black);
            border: 1px solid var(--border-iron);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .memory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .soul-fragment {
            aspect-ratio: 1;
            background: var(--stone-dark);
            border: 1px solid var(--border-iron);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--faded-text);
        }

        .soul-fragment.obtained {
            background: var(--ember-glow);
            color: var(--blood-dark);
            border-color: var(--ember-glow);
            box-shadow: 0 0 10px rgba(184, 134, 11, 0.5);
        }

        .soul-fragment:hover {
            transform: scale(1.1);
            border-color: var(--ember-glow);
        }

        /* Audio Controls */
        .item-menu {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .menu-item {
            padding: 0.75rem 1.5rem;
            background: var(--stone-dark);
            border: 1px solid var(--border-iron);
            color: var(--pale-text);
            font-family: 'Crimson Text', serif;
            cursor: pointer;
            transition: all 0.2s;
        }

        .menu-item:hover {
            background: var(--ash-black);
            border-color: var(--ember-glow);
        }

        .menu-item.active {
            background: var(--ember-glow);
            color: var(--blood-dark);
        }

        /* Modal */
        .dark-sign-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 8, 6, 0.95);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--stone-dark);
            border: 2px solid var(--border-iron);
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-title {
            font-family: 'Cinzel', serif;
            font-size: 1.5rem;
            color: var(--ember-glow);
            margin-bottom: 1rem;
        }

        .modal-text {
            color: var(--pale-text);
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--faded-text);
            font-style: italic;
        }

        /* Error message */
        .error-message {
            background: var(--blood-red);
            color: var(--pale-text);
            padding: 1rem;
            margin: 1rem 0;
            border: 1px solid darkred;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Abstract Garden</h1>
            <p class="subtitle">The Souls of Digital Creation</p>
        </div>

        <!-- Loading indicator -->
        <div id="loading" class="loading">Kindling the First Flame...</div>

        <!-- Main Content (hidden initially) -->
        <div id="main-content" style="display: none;">
            <!-- Soul Counter -->
            <div class="souls-bar">
                <div class="soul-counter">
                    <span>✦</span>
                    <span class="soul-value" id="xp-display">0 SOULS</span>
                </div>
                <div class="soul-counter">
                    <span>◈</span>
                    <span class="soul-value" id="coins-display">0 EMBERS</span>
                </div>
                <div class="soul-counter">
                    <span>⚔</span>
                    <span class="soul-value" id="level-display">LEVEL 1</span>
                </div>
            </div>

            <!-- Main Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Portfolio Worth</div>
                    <div class="stat-value" id="portfolio-value">$0</div>
                    <div class="stat-subtitle">The weight of thy creations</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Monthly Tithe</div>
                    <div class="stat-value" id="monthly-income">$0</div>
                    <div class="stat-subtitle">Passive souls gathered</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Tasks Vanquished</div>
                    <div class="stat-value" id="tasks-complete">0/0</div>
                    <div class="stat-subtitle">Issues laid to rest</div>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="estus-progress">
                <div class="progress-header">
                    <div class="progress-title">Journey Progress</div>
                    <div id="progress-percentage">0%</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="main-progress" style="width: 0%"></div>
                </div>
                <div class="progress-message" id="progress-message">
                    Thou art yet to begin thy journey, Hollow one...
                </div>
            </div>

            <!-- Sprint Bonfires -->
            <div class="bonfire-grid">
                <div class="bonfire-card" id="sprint-1-card">
                    <div class="bonfire-header">
                        <div class="bonfire-title">Sprint 1: Foundation</div>
                        <div id="sprint-1-percent">0%</div>
                    </div>
                    <div class="bonfire-progress">
                        <div class="bonfire-flame" id="sprint-1-flame" style="width: 0%"></div>
                    </div>
                    <div class="stat-subtitle" id="sprint-1-subtitle">0/0 trials</div>
                </div>
                
                <div class="bonfire-card" id="sprint-2-card">
                    <div class="bonfire-header">
                        <div class="bonfire-title">Sprint 2: Animation</div>
                        <div id="sprint-2-percent">0%</div>
                    </div>
                    <div class="bonfire-progress">
                        <div class="bonfire-flame" id="sprint-2-flame" style="width: 0%"></div>
                    </div>
                    <div class="stat-subtitle" id="sprint-2-subtitle">0/0 trials</div>
                </div>
                
                <div class="bonfire-card" id="sprint-3-card">
                    <div class="bonfire-header">
                        <div class="bonfire-title">Sprint 3: Polish</div>
                        <div id="sprint-3-percent">0%</div>
                    </div>
                    <div class="bonfire-progress">
                        <div class="bonfire-flame" id="sprint-3-flame" style="width: 0%"></div>
                    </div>
                    <div class="stat-subtitle" id="sprint-3-subtitle">0/0 trials</div>
                </div>
                
                <div class="bonfire-card" id="side-quest-card">
                    <div class="bonfire-header">
                        <div class="bonfire-title">Side Quests</div>
                        <div id="side-quest-percent">0%</div>
                    </div>
                    <div class="bonfire-progress">
                        <div class="bonfire-flame" id="side-quest-flame" style="width: 0%"></div>
                    </div>
                    <div class="stat-subtitle" id="side-quest-subtitle">0/0 found</div>
                </div>
            </div>

            <!-- Memory Chamber -->
            <div class="memory-chamber">
                <div class="progress-header">
                    <div class="progress-title">Memory Fragments</div>
                    <div><span id="memories-unlocked">0</span>/49 recovered</div>
                </div>
                <div class="memory-grid" id="memory-grid">
                    <!-- Generated by JS -->
                </div>
                <div class="item-menu">
                    <button class="menu-item" id="vo-toggle">Voice: Silent</button>
                    <button class="menu-item" id="music-toggle">Ambience: Silent</button>
                    <button class="menu-item" id="story-mode">Read Chronicles</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="dark-sign-modal" id="story-modal">
        <div class="modal-content">
            <div class="modal-title" id="story-title">Memory Fragment</div>
            <div class="modal-text" id="story-content">
                The echoes of forgotten knowledge whisper through the digital void...
            </div>
            <button class="menu-item" onclick="closeModal()">
                Return to the Waking World
            </button>
        </div>
    </div>

    <!-- Audio elements -->
    <audio id="intro-narration" src="audio/intro-narration.mp3"></audio>
    <audio id="ambient-music" src="audio/dark-ambience.mp3" loop></audio>

    <script>
        // Global state
        let issues = [];
        let audioState = {
            voEnabled: false,
            musicEnabled: false,
            introPlayed: false
        };

        // Variable XP/Coin system based on issue complexity
        const REWARD_SYSTEM = {
            labels: {
                'Sprint 1': { xp: 50, coins: 25, value: 75 },
                'Sprint 2': { xp: 100, coins: 50, value: 150 },
                'Sprint 3': { xp: 150, coins: 75, value: 225 },
                'side-quest': { xp: 200, coins: 100, value: 300 },
                'epic': { xp: 500, coins: 250, value: 1000 },
                'bug': { xp: 25, coins: 10, value: 50 },
                'enhancement': { xp: 75, coins: 35, value: 100 }
            },
            default: { xp: 50, coins: 25, value: 100 }
        };

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('Initializing Abstract Garden...');
            
            try {
                // Load issues from the generated JSON
                const response = await fetch('data/issues.json');
                if (!response.ok) throw new Error('Failed to load issues data');
                
                issues = await response.json();
                console.log(`Loaded ${issues.length} issues from GitHub`);
                
                // Process and display data
                updateDashboard();
                generateMemoryGrid();
                setupEventHandlers();
                
                // Hide loading, show content
                document.getElementById('loading').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
                
                // Auto-play intro narration after a short delay
                setTimeout(() => {
                    if (!audioState.introPlayed) {
                        playIntroNarration();
                    }
                }, 2000);
                
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loading').innerHTML = 
                    `<div class="error-message">Failed to kindle the flame: ${error.message}</div>`;
            }
        });

        function calculateRewards(issue) {
            // Check each label and sum rewards
            let totalXP = 0;
            let totalCoins = 0;
            let totalValue = 0;
            
            if (issue.labels && issue.labels.length > 0) {
                issue.labels.forEach(label => {
                    const reward = REWARD_SYSTEM.labels[label.name] || REWARD_SYSTEM.default;
                    totalXP += reward.xp;
                    totalCoins += reward.coins;
                    totalValue += reward.value;
                });
            } else {
                // No labels, use default
                totalXP = REWARD_SYSTEM.default.xp;
                totalCoins = REWARD_SYSTEM.default.coins;
                totalValue = REWARD_SYSTEM.default.value;
            }
            
            return { xp: totalXP, coins: totalCoins, value: totalValue };
        }

        function updateDashboard() {
            // Filter out non-issues (like PRs) and dashboard issues
            const realIssues = issues.filter(issue => 
                !issue.pull_request && 
                !issue.labels?.some(l => l.name === 'dashboard')
            );
            
            const closedIssues = realIssues.filter(issue => issue.state === 'closed');
            
            // Calculate total rewards from closed issues
            let totalXP = 0;
            let totalCoins = 0;
            let portfolioValue = 0;
            
            closedIssues.forEach(issue => {
                const rewards = calculateRewards(issue);
                totalXP += rewards.xp;
                totalCoins += rewards.coins;
                portfolioValue += rewards.value;
            });
            
            // Calculate level from XP
            const level = Math.floor(Math.sqrt(totalXP / 100)) + 1;
            const levelTitle = getLevelTitle(level);
            
            // Update UI
            document.getElementById('xp-display').textContent = `${totalXP.toLocaleString()} SOULS`;
            document.getElementById('coins-display').textContent = `${totalCoins.toLocaleString()} EMBERS`;
            document.getElementById('level-display').textContent = `LEVEL ${level} - ${levelTitle}`;
            document.getElementById('portfolio-value').textContent = `$${portfolioValue.toLocaleString()}`;
            document.getElementById('monthly-income').textContent = `$${Math.round(portfolioValue * 0.2)}`;
            document.getElementById('tasks-complete').textContent = `${closedIssues.length}/${realIssues.length}`;
            
            // Update progress
            const progress = realIssues.length > 0 ? 
                Math.round((closedIssues.length / realIssues.length) * 100) : 0;
            document.getElementById('progress-percentage').textContent = `${progress}%`;
            document.getElementById('main-progress').style.width = `${progress}%`;
            
            // Update progress message
            updateProgressMessage(progress);
            
            // Update sprint bonfires
            updateSprintProgress(realIssues);
            
            // Update memories
            document.getElementById('memories-unlocked').textContent = 
                Math.min(closedIssues.length, 49);
        }

        function getLevelTitle(level) {
            const titles = [
                'Hollow', 'Unkindled', 'Bearer of the Curse', 'Ashen One',
                'Seeker of Fire', 'Keeper of Embers', 'Digital Wanderer',
                'Code Weaver', 'Render Knight', 'Shader Sorcerer',
                'Lord of Cinder', 'Transcendent', 'Eternal Fragment'
            ];
            return titles[Math.min(level - 1, titles.length - 1)];
        }

        function updateProgressMessage(progress) {
            const messages = [
                "Thou art yet to begin thy journey, Hollow one...",
                "The First Flame flickers. Thy path begins to reveal itself...",
                "Souls gathered. The ancient knowledge stirs within thee...",
                "The machine spirits acknowledge thy dedication...",
                "Halfway through thy trials. The digital realm bends to thy will...",
                "Mastery approaches. Soon thou shalt transcend mortality...",
                "Near the throne. The cycle nears completion...",
                "Thou hast linked the Fire. The Age of Dark is forestalled..."
            ];
            
            const index = Math.min(Math.floor(progress / 12.5), messages.length - 1);
            document.getElementById('progress-message').textContent = messages[index];
        }

        function updateSprintProgress(realIssues) {
            // Count by sprint labels
            const sprints = {
                'Sprint 1': { total: 0, closed: 0 },
                'Sprint 2': { total: 0, closed: 0 },
                'Sprint 3': { total: 0, closed: 0 },
                'side-quest': { total: 0, closed: 0 }
            };
            
            realIssues.forEach(issue => {
                issue.labels?.forEach(label => {
                    if (sprints[label.name]) {
                        sprints[label.name].total++;
                        if (issue.state === 'closed') {
                            sprints[label.name].closed++;
                        }
                    }
                });
            });
            
            // Update Sprint 1
            updateBonfire('sprint-1', sprints['Sprint 1']);
            
            // Update Sprint 2
            updateBonfire('sprint-2', sprints['Sprint 2']);
            
            // Update Sprint 3
            updateBonfire('sprint-3', sprints['Sprint 3']);
            
            // Update Side Quests
            updateBonfire('side-quest', sprints['side-quest']);
        }

        function updateBonfire(id, data) {
            const percent = data.total > 0 ? 
                Math.round((data.closed / data.total) * 100) : 0;
            
            document.getElementById(`${id}-percent`).textContent = `${percent}%`;
            document.getElementById(`${id}-flame`).style.width = `${percent}%`;
            document.getElementById(`${id}-subtitle`).textContent = 
                `${data.closed}/${data.total} trials`;
            
            // Light the bonfire if complete
            if (percent === 100 && data.total > 0) {
                document.getElementById(`${id}-card`).classList.add('lit');
            }
        }

        function generateMemoryGrid() {
            const grid = document.getElementById('memory-grid');
            grid.innerHTML = '';
            
            // Get closed issue count
            const closedCount = issues.filter(issue => 
                issue.state === 'closed' && 
                !issue.pull_request &&
                !issue.labels?.some(l => l.name === 'dashboard')
            ).length;
            
            for (let i = 1; i <= 49; i++) {
                const fragment = document.createElement('div');
                fragment.className = 'soul-fragment';
                fragment.dataset.memoryId = i;
                fragment.textContent = i;
                
                if (i <= closedCount) {
                    fragment.classList.add('obtained');
                    fragment.addEventListener('click', () => showMemory(i));
                }
                
                grid.appendChild(fragment);
            }
        }

        function showMemory(id) {
            const memories = [
                "In 1843, Ada Lovelace wrote the first algorithm, birthing digital creation...",
                "Ivan Sutherland's Sketchpad in 1963 introduced the world to computer graphics...",
                "The Utah Teapot became the first standard 3D test model in 1975...",
                "Ed Catmull invented texture mapping, bringing surfaces to life...",
                "John Carmack's BSP trees revolutionized real-time 3D rendering...",
                // Add more memories...
            ];
            
            document.getElementById('story-title').textContent = `Memory Fragment ${id}`;
            document.getElementById('story-content').textContent = 
                memories[id - 1] || `Fragment ${id}: The echoes of creation resonate...`;
            document.getElementById('story-modal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('story-modal').style.display = 'none';
        }

        function playIntroNarration() {
            const audio = document.getElementById('intro-narration');
            const music = document.getElementById('ambient-music');
            
            // Play intro narration
            audio.volume = 1.0;
            audio.play().catch(e => console.log('Auto-play blocked:', e));
            
            // Start ambient music at lower volume
            music.volume = 0.3;
            music.play().catch(e => console.log('Music auto-play blocked:', e));
            
            audioState.introPlayed = true;
            audioState.voEnabled = true;
            audioState.musicEnabled = true;
            
            // Update UI
            document.getElementById('vo-toggle').classList.add('active');
            document.getElementById('vo-toggle').textContent = 'Voice: British Lady';
            document.getElementById('music-toggle').classList.add('active');
            document.getElementById('music-toggle').textContent = 'Ambience: Active';
        }

        function setupEventHandlers() {
            // Audio controls
            document.getElementById('vo-toggle').addEventListener('click', function() {
                audioState.voEnabled = !audioState.voEnabled;
                this.classList.toggle('active');
                this.textContent = audioState.voEnabled ? 'Voice: British Lady' : 'Voice: Silent';
                
                if (!audioState.voEnabled) {
                    document.getElementById('intro-narration').pause();
                }
            });
            
            document.getElementById('music-toggle').addEventListener('click', function() {
                audioState.musicEnabled = !audioState.musicEnabled;
                this.classList.toggle('active');
                this.textContent = audioState.musicEnabled ? 'Ambience: Active' : 'Ambience: Silent';
                
                const music = document.getElementById('ambient-music');
                if (audioState.musicEnabled) {
                    music.play();
                } else {
                    music.pause();
                }
            });
            
            // Story mode
            document.getElementById('story-mode').addEventListener('click', function() {
                showChronicles();
            });
            
            // Close modal on background click
            document.getElementById('story-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
        }

        function showChronicles() {
            const closedIssues = issues.filter(issue => 
                issue.state === 'closed' && 
                !issue.pull_request &&
                !issue.labels?.some(l => l.name === 'dashboard')
            );
            
            document.getElementById('story-title').textContent = 'Chronicles of the Abstract Garden';
            
            let content = '<div style="max-height: 60vh; overflow-y: auto;">';
            content += `<p style="margin-bottom: 1rem;">You have completed ${closedIssues.length} trials...</p>`;
            
            closedIssues.forEach((issue, index) => {
                const rewards = calculateRewards(issue);
                content += `
                    <div style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-iron);">
                        <h3 style="color: var(--ember-glow); margin-bottom: 0.5rem;">
                            ${index + 1}. ${issue.title}
                        </h3>
                        <p style="color: var(--faded-text); font-size: 0.85rem;">
                            +${rewards.xp} souls • +${rewards.coins} embers • $${rewards.value} value
                        </p>
                    </div>
                `;
            });
            
            content += '</div>';
            document.getElementById('story-content').innerHTML = content;
            document.getElementById('story-modal').style.display = 'block';
        }

        // Auto-refresh every 5 minutes
        setInterval(async () => {
            try {
                const response = await fetch('data/issues.json');
                if (response.ok) {
                    issues = await response.json();
                    updateDashboard();
                    generateMemoryGrid();
                }
            } catch (e) {
                console.error('Failed to refresh data:', e);
            }
        }, 5 * 60 * 1000);
    </script>
</body>
</html>
