<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abstract Garden - 3D Learning Dashboard</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');
        
        :root {
            --bg-primary: #0B0E11;
            --bg-secondary: #161922;
            --bg-card: #1F2937;
            --accent-primary: #7C3AED;
            --accent-secondary: #F59E0B;
            --accent-success: #10B981;
            --text-primary: #F9FAFB;
            --text-secondary: #D1D5DB;
            --text-muted: #9CA3AF;
            --border-primary: #374151;
            --border-accent: #7C3AED;
            --glow-primary: rgba(124, 58, 237, 0.4);
            --glow-secondary: rgba(245, 158, 11, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(124, 58, 237, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(245, 158, 11, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(16, 185, 129, 0.05) 0%, transparent 50%);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Header Design */
        .header {
            text-align: center;
            margin-bottom: 3rem;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 2px;
        }

        h1 {
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px var(--glow-primary);
            margin-bottom: 1rem;
            letter-spacing: -0.02em;
        }

        .subtitle {
            font-size: 1.25rem;
            color: var(--text-secondary);
            font-weight: 300;
            margin-bottom: 2rem;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(124, 58, 237, 0.1);
            border: 1px solid var(--accent-primary);
            border-radius: 2rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--accent-primary);
            margin-top: 1rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: 1rem;
            padding: 2rem;
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            opacity: 0;
            transition: opacity 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            border-color: var(--accent-primary);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 0 20px var(--glow-primary);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .stat-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        }

        .stat-value {
            font-size: 2.75rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary), var(--accent-secondary));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1;
            margin-bottom: 0.5rem;
            font-family: 'JetBrains Mono', monospace;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .stat-subtitle {
            color: var(--text-muted);
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }

        /* Progress Section */
        .progress-section {
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: 1rem;
            padding: 2rem;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
        }

        .progress-bar {
            background: rgba(0, 0, 0, 0.3);
            height: 40px;
            border-radius: 20px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: #ffd700;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #333;
            transition: width 1s ease;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .sprint-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .sprint-badge {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        .sprint-badge.completed {
            background: rgba(255, 215, 0, 0.2);
            border-color: #ffd700;
        }

        .memory-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
        }

        .memory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        .memory-fragment {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .memory-fragment.collected {
            background: rgba(255, 215, 0, 0.2);
            border-color: #ffd700;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .leaderboard {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
        }

        .leader-row {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            align-items: center;
        }

        .leader-rank {
            font-size: 1.5em;
            width: 50px;
            text-align: center;
        }

        .leader-name {
            flex: 1;
            padding: 0 20px;
        }

        .leader-stats {
            text-align: right;
        }

        .rank-1 { color: #ffd700; }
        .rank-2 { color: #c0c0c0; }
        .rank-3 { color: #cd7f32; }

        .cta-button {
            display: inline-block;
            background: #ffd700;
            color: #333;
            padding: 15px 40px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: bold;
            font-size: 1.2em;
            margin: 20px auto;
            display: block;
            text-align: center;
            max-width: 300px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }

        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.6);
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            opacity: 0.7;
        }
        .story-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.5s ease;
        }

        .story-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            text-align: center;
            position: relative;
            border: 2px solid #ffd700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
        }

        .story-glow {
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: linear-gradient(45deg, #ffd700, transparent, #ffd700);
            border-radius: 25px;
            z-index: -1;
            animation: pulse 2s infinite;
        }

        .story-title {
            color: #ffd700;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .story-text {
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 30px;
            color: #e0e0e0;
        }

        .story-close {
            background: #ffd700;
            color: #333;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .story-close:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }

        .achievement-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.5);
            z-index: 1001;
            animation: slideIn 0.5s ease;
        }

        .achievement-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .achievement-icon {
            font-size: 2em;
        }

        .xp-gain {
            position: fixed;
            color: #ffd700;
            font-weight: bold;
            font-size: 1.2em;
            z-index: 999;
            animation: floatUp 2s ease forwards;
            pointer-events: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        @keyframes floatUp {
            from { transform: translateY(0); opacity: 1; }
            to { transform: translateY(-100px); opacity: 0; }
        }

        .audio-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .audio-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            color: #ffd700;
            padding: 10px;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .audio-btn:hover {
            background: rgba(255, 215, 0, 0.2);
            transform: scale(1.1);
        }

        .audio-btn.disabled {
            opacity: 0.3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🌳 Abstract Garden</h1>
        <p class="subtitle">3D Animation Production - Gamified Learning Journey</p>

        <!-- Main Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Portfolio Value</div>
                <div class="stat-value" id="portfolio-value">$0</div>
                <div class="stat-label">Real Market Value</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Monthly Income</div>
                <div class="stat-value" id="monthly-income">$0</div>
                <div class="stat-label">Passive Potential</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Level</div>
                <div class="stat-value" id="level">0</div>
                <div class="stat-label" id="level-title">Beginner</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Tasks Complete</div>
                <div class="stat-value" id="tasks-complete">0/49</div>
                <div class="stat-label">Main Tasks</div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-section">
            <h2>Overall Progress</h2>
            <div class="progress-bar">
                <div class="progress-fill" id="main-progress" style="width: 0%">
                    0%
                </div>
            </div>
            <p id="progress-message" style="text-align: center; margin-top: 20px; opacity: 0.9;">
                Start your journey by completing your first task!
            </p>
        </div>

        <!-- Sprint Progress -->
        <div class="progress-section">
            <h2>Sprint Progress</h2>
            <div class="sprint-grid">
                <div class="sprint-badge" id="sprint-1">
                    <div>Sprint 1</div>
                    <div style="font-size: 1.5em; margin: 10px 0;">0%</div>
                </div>
                <div class="sprint-badge" id="sprint-2">
                    <div>Sprint 2</div>
                    <div style="font-size: 1.5em; margin: 10px 0;">0%</div>
                </div>
                <div class="sprint-badge" id="sprint-3">
                    <div>Sprint 3</div>
                    <div style="font-size: 1.5em; margin: 10px 0;">0%</div>
                </div>
            </div>
        </div>

        <!-- Memory Collection -->
        <div class="memory-section">
            <h2>Memory Fragments Collected</h2>
            <p style="opacity: 0.9; margin-top: 10px;">Each task unlocks a piece of CG history</p>
            <div class="memory-grid" id="memory-grid">
                <!-- Will be populated with 49 fragments -->
            </div>
            <p id="memory-count" style="text-align: center; margin-top: 20px;">
                0/49 memories collected
            </p>
        </div>

        <!-- Leaderboard -->
        <div class="leaderboard">
            <h2>Leaderboard</h2>
            <div id="leaderboard-content">
                <div class="loading">Loading data from GitHub...</div>
            </div>
        </div>

        <!-- Call to Action -->
                <!-- Call to Action -->
        <a href="https://github.com/Studio-Dashosa/abstract-garden-video/issues?q=is%3Aissue+is%3Aopen+label%3A%22Sprint+1%22" class="cta-button">
            Start Sprint 1 Tasks →
        </a>
    </div>

    <!-- Audio Controls -->
    <div class="audio-controls">
        <button class="audio-btn" id="voice-toggle" title="Toggle Voice Over">🎤</button>
        <button class="audio-btn" id="music-toggle" title="Toggle Ambient Music">🎵</button>
    </div>

    <script type="module" src="./js/story-system.js"></script>
    <script src="./js/audio-system.js"></script>
    <script>

        <a href="./stories/player.html" class="cta-button" style="background:#7bd389;color:#102;">
            Listen: Witchy British Narration →
        </a>
    </div>

    <script>
        // Fetch data built by CI (private-friendly). Fallback to GitHub API if available/public.
        async function fetchDashboardData() {
            try {
                const repo = 'Studio-Dashosa/abstract-garden-video';
                let issues = [];

                // 1) Try static data generated by GitHub Actions (works for private repos)
                try {
                    const local = await fetch('./data/issues.json', { cache: 'no-store' });
                    if (local.ok) {
                        issues = await local.json();
                    } else {
                        throw new Error('No local data');
                    }
                } catch (_) {
                    // 2) Fallback to GitHub API (works for public repos or if user supplies token manually)
                    const issuesResponse = await fetch(`https://api.github.com/repos/${repo}/issues?state=all&per_page=100`, {
                        headers: { 'Accept': 'application/vnd.github.v3+json' }
                    });
                    if (!issuesResponse.ok) {
                        throw new Error(`GitHub API Error: ${issuesResponse.status}`);
                    }
                    issues = await issuesResponse.json();
                }
                
                // Calculate stats
                const closedIssues = issues.filter(i => i.state === 'closed' && !i.pull_request);
                const openIssues = issues.filter(i => i.state === 'open' && !i.pull_request);
                
                // Update stats
                const totalTasks = 49;
                const completedTasks = Math.min(closedIssues.length, totalTasks);
                const progress = Math.round((completedTasks / totalTasks) * 100);
                
                // Portfolio value calculation (simplified)
                const avgValue = 75;
                const portfolioValue = completedTasks * avgValue;
                const monthlyIncome = Math.round(portfolioValue * 0.2);
                
                // Update DOM
                document.getElementById('portfolio-value').textContent = `$${portfolioValue.toLocaleString()}`;
                document.getElementById('monthly-income').textContent = `$${monthlyIncome}`;
                document.getElementById('tasks-complete').textContent = `${completedTasks}/${totalTasks}`;
                document.getElementById('main-progress').style.width = `${progress}%`;
                document.getElementById('main-progress').textContent = `${progress}%`;
                
                // Calculate level
                const xp = completedTasks * 100;
                const level = Math.floor(Math.sqrt(xp / 100)) + 1;
                const levelTitles = ['Beginner', 'Apprentice', 'Professional', 'Expert', 'Master', 'Elite'];
                
                document.getElementById('level').textContent = level;
                document.getElementById('level-title').textContent = levelTitles[Math.min(level - 1, 5)];
                
                // Update progress message
                const messages = [
                    "Start your journey by completing your first task!",
                    "Great start! Keep the momentum going!",
                    "You're making excellent progress!",
                    "Halfway there! Your portfolio is growing!",
                    "Amazing work! The finish line is in sight!",
                    "Project complete! Your portfolio is ready for market!"
                ];
                
                const messageIndex = Math.floor((progress / 100) * (messages.length - 1));
                document.getElementById('progress-message').textContent = messages[messageIndex];
                
                // Update memory fragments
                const memoryGrid = document.getElementById('memory-grid');
                memoryGrid.innerHTML = '';
                for (let i = 0; i < 49; i++) {
                    const fragment = document.createElement('div');
                    fragment.className = 'memory-fragment' + (i < completedTasks ? ' collected' : '');
                    fragment.textContent = i < completedTasks ? '✨' : '?';
                    fragment.title = i < completedTasks ? 'Memory collected!' : 'Complete a task to unlock';
                    memoryGrid.appendChild(fragment);
                }
                
                document.getElementById('memory-count').textContent = `${completedTasks}/49 memories collected`;
                
                // Update sprint progress
                const sprint1Tasks = closedIssues.filter(i => 
                    i.labels.some(l => l.name === 'Sprint 1')
                ).length;
                const sprint2Tasks = closedIssues.filter(i => 
                    i.labels.some(l => l.name === 'Sprint 2')
                ).length;
                const sprint3Tasks = closedIssues.filter(i => 
                    i.labels.some(l => l.name === 'Sprint 3')
                ).length;
                
                const updateSprint = (id, completed, total) => {
                    const element = document.getElementById(id);
                    const percent = Math.round((completed / total) * 100);
                    element.querySelector('div:nth-child(2)').textContent = `${percent}%`;
                    if (percent === 100) element.classList.add('completed');
                };
                
                updateSprint('sprint-1', sprint1Tasks, 20);
                updateSprint('sprint-2', sprint2Tasks, 15);
                updateSprint('sprint-3', sprint3Tasks, 14);
                
                // Update leaderboard (simplified for now)
                const leaderboardContent = document.getElementById('leaderboard-content');
                if (completedTasks > 0) {
                    leaderboardContent.innerHTML = `
                        <div class="leader-row">
                            <div class="leader-rank rank-1">🥇</div>
                            <div class="leader-name">Michael</div>
                            <div class="leader-stats">
                                <div>Level ${level}</div>
                                <div style="opacity: 0.8; font-size: 0.9em;">${completedTasks} tasks • $${portfolioValue}</div>
                            </div>
                        </div>
                    `;
                } else {
                    leaderboardContent.innerHTML = '<p style="text-align: center; opacity: 0.7;">Complete tasks to appear on the leaderboard!</p>';
                }
                
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        // Load data on page load
        fetchDashboardData();
        
        // Refresh every 30 seconds
        setInterval(fetchDashboardData, 30000);
    </script>
</body>
</html>