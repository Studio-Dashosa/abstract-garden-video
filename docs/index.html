<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abstract Garden - 3D Learning Dashboard</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');
        
        :root {
            --bg-primary: #0B0E11;
            --bg-secondary: #161922;
            --bg-card: #1F2937;
            --accent-primary: #7C3AED;
            --accent-secondary: #F59E0B;
            --accent-success: #10B981;
            --text-primary: #F9FAFB;
            --text-secondary: #D1D5DB;
            --text-muted: #9CA3AF;
            --border-primary: #374151;
            --border-accent: #7C3AED;
            --glow-primary: rgba(124, 58, 237, 0.4);
            --glow-secondary: rgba(245, 158, 11, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(124, 58, 237, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(245, 158, 11, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(16, 185, 129, 0.05) 0%, transparent 50%);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Header Design */
        .header {
            text-align: center;
            margin-bottom: 3rem;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 2px;
        }

        h1 {
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px var(--glow-primary);
            margin-bottom: 1rem;
            letter-spacing: -0.02em;
        }

        .subtitle {
            font-size: 1.25rem;
            color: var(--text-secondary);
            font-weight: 300;
            margin-bottom: 2rem;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(124, 58, 237, 0.1);
            border: 1px solid var(--accent-primary);
            border-radius: 2rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--accent-primary);
            margin-top: 1rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: 1rem;
            padding: 2rem;
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            opacity: 0;
            transition: opacity 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            border-color: var(--accent-primary);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 0 20px var(--glow-primary);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .stat-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        }

        .stat-value {
            font-size: 2.75rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary), var(--accent-secondary));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1;
            margin-bottom: 0.5rem;
            font-family: 'JetBrains Mono', monospace;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .stat-subtitle {
            color: var(--text-muted);
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }

        /* Progress Section */
        .progress-section {
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .progress-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .progress-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .progress-bar {
            background: var(--bg-secondary);
            border-radius: 0.5rem;
            height: 1rem;
            overflow: hidden;
            margin-bottom: 1rem;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 0.5rem;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -45px;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        /* Sprints Grid */
        .sprints-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .sprint-card {
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: 1rem;
            padding: 1.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .sprint-card.completed {
            border-color: var(--accent-success);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
        }

        .sprint-card:hover {
            transform: translateY(-2px);
            border-color: var(--accent-primary);
        }

        .sprint-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .sprint-title {
            font-weight: 600;
            color: var(--text-primary);
        }

        .sprint-progress {
            background: var(--bg-secondary);
            border-radius: 0.25rem;
            height: 0.5rem;
            overflow: hidden;
            margin-bottom: 0.75rem;
        }

        .sprint-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 0.25rem;
            transition: width 0.6s ease;
        }

        .sprint-stats {
            display: flex;
            justify-content: space-between;
            color: var(--text-muted);
            font-size: 0.875rem;
        }

        /* Memory System */
        .memory-section {
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .memory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 0.75rem;
            margin-top: 1.5rem;
        }

        .memory-fragment {
            aspect-ratio: 1;
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .memory-fragment.unlocked {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-color: var(--accent-primary);
            box-shadow: 0 0 15px var(--glow-primary);
        }

        .memory-fragment:hover {
            transform: scale(1.05);
            border-color: var(--accent-primary);
        }

        .memory-fragment.unlocked:hover {
            box-shadow: 0 0 25px var(--glow-primary);
        }

        /* Audio Controls */
        .audio-controls {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .audio-btn {
            padding: 0.75rem 1.5rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 0.5rem;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .audio-btn:hover {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            transform: translateY(-1px);
        }

        .audio-btn.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        /* Side Quest Alert */
        .side-quest-alert {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.2), rgba(245, 158, 11, 0.2));
            border: 1px solid var(--accent-primary);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .side-quest-alert h3 {
            color: var(--accent-secondary);
            margin-bottom: 0.5rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .sprints-grid {
                grid-template-columns: 1fr;
            }
            
            .memory-grid {
                grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
                gap: 0.5rem;
            }
        }

        /* Loading State */
        .loading {
            opacity: 0.5;
            pointer-events: none;
        }

        .error {
            color: #EF4444;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid #EF4444;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🌳 Abstract Garden</h1>
            <p class="subtitle">3D Animation Production - Gamified Learning Journey</p>
            <div class="badge">
                🎮 FromSoft-Style Progression • 🇬🇧 British VO • 💰 Real Portfolio Value
            </div>
        </div>

        <!-- Side Quest Alert -->
        <div class="side-quest-alert">
            <h3>🎭 Missing Side Quests Detected!</h3>
            <p>18 additional side quest issues need to be created to unlock the hidden stories:<br>
            <strong>The Forgotten Women</strong> • <strong>The Eastern Masters</strong> • <strong>The Open Source Heroes</strong></p>
        </div>

        <!-- Main Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">💰</div>
                    <div>
                        <div class="stat-label">Portfolio Value</div>
                        <div class="stat-subtitle">Real Market Value</div>
                    </div>
                </div>
                <div class="stat-value" id="portfolio-value">$0</div>
                <div class="stat-subtitle">Based on CGTrader pricing research</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">📈</div>
                    <div>
                        <div class="stat-label">Monthly Income</div>
                        <div class="stat-subtitle">Passive Potential</div>
                    </div>
                </div>
                <div class="stat-value" id="monthly-income">$0</div>
                <div class="stat-subtitle">20% monthly sales rate projection</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">⚡</div>
                    <div>
                        <div class="stat-label">Level</div>
                        <div class="stat-subtitle" id="level-title">Beginner</div>
                    </div>
                </div>
                <div class="stat-value" id="level">0</div>
                <div class="stat-subtitle">FromSoft-style XP progression</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon">🎯</div>
                    <div>
                        <div class="stat-label">Tasks Complete</div>
                        <div class="stat-subtitle">Main Quest Progress</div>
                    </div>
                </div>
                <div class="stat-value" id="tasks-complete">0/67</div>
                <div class="stat-subtitle">49 main + 18 side quests</div>
            </div>
        </div>

        <!-- Progress Section -->
        <div class="progress-section">
            <div class="progress-header">
                <h2 class="progress-title">📊 Learning Progress</h2>
                <div id="progress-percentage">0%</div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="main-progress" style="width: 0%"></div>
            </div>
            <div class="progress-text" id="progress-message">
                Start your journey by completing your first task!
            </div>
        </div>

        <!-- Sprints Grid -->
        <div class="sprints-grid">
            <div class="sprint-card" id="sprint-1">
                <div class="sprint-header">
                    <div class="sprint-title">🚀 Sprint 1: Foundation</div>
                    <div>0%</div>
                </div>
                <div class="sprint-progress">
                    <div class="sprint-progress-fill" style="width: 0%"></div>
                </div>
                <div class="sprint-stats">
                    <span>Installation & First Touch</span>
                    <span>8 tasks</span>
                </div>
            </div>
            
            <div class="sprint-card" id="sprint-2">
                <div class="sprint-header">
                    <div class="sprint-title">⚡ Sprint 2: Core Skills</div>
                    <div>0%</div>
                </div>
                <div class="sprint-progress">
                    <div class="sprint-progress-fill" style="width: 0%"></div>
                </div>
                <div class="sprint-stats">
                    <span>Modeling & Animation</span>
                    <span>28 tasks</span>
                </div>
            </div>
            
            <div class="sprint-card" id="sprint-3">
                <div class="sprint-header">
                    <div class="sprint-title">🔥 Sprint 3: Mastery</div>
                    <div>0%</div>
                </div>
                <div class="sprint-progress">
                    <div class="sprint-progress-fill" style="width: 0%"></div>
                </div>
                <div class="sprint-stats">
                    <span>Advanced Integration</span>
                    <span>21 tasks</span>
                </div>
            </div>
            
            <div class="sprint-card" id="side-quests">
                <div class="sprint-header">
                    <div class="sprint-title">🎭 Side Quests</div>
                    <div>0%</div>
                </div>
                <div class="sprint-progress">
                    <div class="sprint-progress-fill" style="width: 0%"></div>
                </div>
                <div class="sprint-stats">
                    <span>Hidden Stories</span>
                    <span>18 quests</span>
                </div>
            </div>
        </div>

        <!-- Memory System -->
        <div class="memory-section">
            <div class="progress-header">
                <h2 class="progress-title">🧠 Memory Fragments</h2>
                <div>
                    <span id="memories-unlocked">0</span>/49 stories discovered
                </div>
            </div>
            <div class="memory-grid" id="memory-grid">
                <!-- Memory fragments will be generated by JavaScript -->
            </div>
            <div class="audio-controls">
                <button class="audio-btn" id="vo-toggle">🎙️ British VO: OFF</button>
                <button class="audio-btn" id="music-toggle">🎵 Ambient Music: OFF</button>
                <button class="audio-btn" id="story-mode">📖 Story Mode</button>
            </div>
        </div>

    </div>

    <!-- Story Modal -->
    <div id="story-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--bg-card); border-radius: 1rem; padding: 2rem; max-width: 600px; width: 90%;">
            <h3 id="story-title"></h3>
            <p id="story-content"></p>
            <div style="margin-top: 1rem;">
                <button class="audio-btn" onclick="document.getElementById('story-modal').style.display='none'">Close</button>
            </div>
        </div>
    </div>

    <script type="module" src="js/story-system.js"></script>
    <script type="module" src="js/audio-system.js"></script>
    
    <script>
        let issues = [];
        
        async function loadData() {
            try {
                const repo = 'Studio-Dashosa/abstract-garden-video';
                
                // Try local data first
                try {
                    const local = await fetch('./data/issues.json', { cache: 'no-store' });
                    if (local.ok) {
                        issues = await local.json();
                    } else {
                        throw new Error('No local data');
                    }
                } catch (_) {
                    // Fallback to GitHub API
                    const issuesResponse = await fetch(`https://api.github.com/repos/${repo}/issues?state=all&per_page=100`, {
                        headers: { 'Accept': 'application/vnd.github.v3+json' }
                    });
                    if (!issuesResponse.ok) {
                        throw new Error(`GitHub API Error: ${issuesResponse.status}`);
                    }
                    issues = await issuesResponse.json();
                }

                updateDashboard();
                generateMemoryGrid();
            } catch (error) {
                console.error('Error loading data:', error);
                document.body.innerHTML += `<div class="error">Failed to load data: ${error.message}</div>`;
            }
        }

        function updateDashboard() {
            if (!issues.length) return;

            // Filter real tasks (exclude dashboard and PRs)
            const realIssues = issues.filter(issue => 
                !issue.pull_request && 
                issue.number !== 78 && // dashboard issue
                issue.number >= 22 // real tasks start at 22
            );

            const closedIssues = realIssues.filter(issue => issue.state === 'closed');
            const completedTasks = closedIssues.length;
            const totalTasks = realIssues.length;
            const progress = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

            // Calculate portfolio value (more sophisticated calculation)
            const portfolioValue = calculatePortfolioValue(completedTasks);
            const monthlyIncome = Math.round(portfolioValue * 0.2);
            
            // Update DOM
            document.getElementById('portfolio-value').textContent = `$${portfolioValue.toLocaleString()}`;
            document.getElementById('monthly-income').textContent = `$${monthlyIncome}`;
            document.getElementById('tasks-complete').textContent = `${completedTasks}/${totalTasks}`;
            document.getElementById('progress-percentage').textContent = `${progress}%`;
            document.getElementById('main-progress').style.width = `${progress}%`;
            
            // Calculate level (FromSoft style)
            const xp = completedTasks * 100;
            const level = Math.floor(Math.sqrt(xp / 100)) + 1;
            const levelTitles = ['Beginner', 'Apprentice', 'Journeyman', 'Expert', 'Master', 'Legend'];
            
            document.getElementById('level').textContent = level;
            document.getElementById('level-title').textContent = levelTitles[Math.min(level - 1, 5)];
            
            // Update progress message
            const messages = [
                "Start your journey by completing your first task!",
                "First steps taken. The path reveals itself...",
                "Progress grows. Ancient knowledge awakens...",
                "The machine spirits take notice of your dedication...",
                "Halfway through your trials. Power flows through your work...",
                "Mastery approaches. The digital realm bends to your will...",
                "You have achieved Digital Ascension. The cycle completes..."
            ];
            
            const messageIndex = Math.min(Math.floor(progress / 15), messages.length - 1);
            document.getElementById('progress-message').textContent = messages[messageIndex];
            
            updateSprintProgress(closedIssues);
        }

        function calculatePortfolioValue(completedTasks) {
            // Sophisticated value calculation based on task types
            const baseValue = completedTasks * 150; // Base $150 per task
            const levelBonus = Math.floor(completedTasks / 10) * 500; // Bonus every 10 tasks
            const masterworkBonus = completedTasks >= 49 ? 10000 : 0; // Masterwork bonus
            return baseValue + levelBonus + masterworkBonus;
        }

        function updateSprintProgress(closedIssues) {
            // Sprint 1: Issues 70-77
            const sprint1Completed = closedIssues.filter(i => i.number >= 70 && i.number <= 77).length;
            updateSprint('sprint-1', sprint1Completed, 8);
            
            // Sprint 2: Issues 42-69 (main curriculum part 1)
            const sprint2Completed = closedIssues.filter(i => i.number >= 42 && i.number <= 69).length;
            updateSprint('sprint-2', sprint2Completed, 28);
            
            // Sprint 3: Issues 22-41 (main curriculum part 2)
            const sprint3Completed = closedIssues.filter(i => i.number >= 22 && i.number <= 41).length;
            updateSprint('sprint-3', sprint3Completed, 20);
            
            // Side quests (to be added)
            updateSprint('side-quests', 0, 18);
        }

        function updateSprint(id, completed, total) {
            const element = document.getElementById(id);
            const percent = Math.round((completed / total) * 100);
            const percentElement = element.querySelector('.sprint-header > div:nth-child(2)');
            const progressBar = element.querySelector('.sprint-progress-fill');
            
            percentElement.textContent = `${percent}%`;
            progressBar.style.width = `${percent}%`;
            
            if (percent === 100) {
                element.classList.add('completed');
            }
        }

        function generateMemoryGrid() {
            const grid = document.getElementById('memory-grid');
            const totalMemories = 49;
            
            for (let i = 1; i <= totalMemories; i++) {
                const fragment = document.createElement('div');
                fragment.className = 'memory-fragment';
                fragment.dataset.memoryId = i;
                fragment.textContent = i;
                
                // Unlock memories based on completed tasks
                const completedTasks = issues.filter(issue => 
                    !issue.pull_request && 
                    issue.number !== 78 && 
                    issue.number >= 22 && 
                    issue.state === 'closed'
                ).length;
                
                if (i <= completedTasks) {
                    fragment.classList.add('unlocked');
                    fragment.addEventListener('click', () => showMemory(i));
                }
                
                grid.appendChild(fragment);
            }
            
            document.getElementById('memories-unlocked').textContent = Math.min(completedTasks, totalMemories);
        }

        function showMemory(memoryId) {
            // This will be enhanced by the story system
            const modal = document.getElementById('story-modal');
            const title = document.getElementById('story-title');
            const content = document.getElementById('story-content');
            
            title.textContent = `Memory Fragment ${memoryId}`;
            content.textContent = `Story fragment ${memoryId} unlocked! This contains a piece of computer graphics history...`;
            
            modal.style.display = 'block';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', loadData);
        
        // Auto-refresh every 5 minutes
        setInterval(loadData, 5 * 60 * 1000);
    </script>
</body>
</html>
